<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unboxing Game</title>
    <link rel="stylesheet" href="unboxing.css">
</head>
<body>
    <h1>Spinjitsu to Win!</h1>
    <div class="wrapper">
        <div class="container">
            <!-- Boxes will be generated by JavaScript -->
        </div>
    </div>
    <div class="marker"></div>
    <div class="spin">
        <img src="./assets/unboxing/fire.webp" alt="fire" class="fire">
        <button class="spinBtn">Spin</button>
        <img src="./assets/unboxing/fire.webp" alt="fire" class="fire">
    </div>

    <script>
        const potentialWinning = [
            {
                name: 'AirpodsPro',
                image: './assets/unboxing/airpodsPro.png'
            },
            {
                name: 'Airforce1',
                image: './assets/unboxing/airforce1.webp'
            },
            {
                name: 'PS5',
                image: './assets/unboxing/ps5.png'
            },
            {
                name: 'Mewtwo',
                image: './assets/unboxing/mewtwo.png'
            },
            {
                name: 'Kyogre',
                image: './assets/unboxing/kyogre.png'
            },
            {
                name: 'Vbucks',
                image: './assets/unboxing/vbucks.webp'
            }
        ];

        let container = document.querySelector('.container');
        let spinBtn = document.querySelector('.spinBtn');
        let fire = document.getElementsByClassName('fire');
        let isSpinning = false;
        let currentOffset = 0;
        let currentAudio = null;


        // Initial setup
        createBoxes();

        spinBtn.addEventListener('click', () => {
            if (isSpinning) return;

            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }

            currentAudio = new Audio('./assets/unboxing/goat.mp3');
            currentAudio.play();

            Array.from(fire).forEach(f => f.style.display = 'block');
            spin();
        });

        function spin() {
    if (isSpinning) return;
    isSpinning = true;

    const spinDuration = 8000;
    const boxWidth = 200;
    const singleSetWidth = boxWidth * potentialWinning.length;
    
    // Spin distance of about 3-4 sets
    const spinDistance = singleSetWidth * (3 + Math.random());

    let startTime = null;

    function animate(currentTime) {
        if (!startTime) startTime = currentTime;
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / spinDuration, 1);

        // Smooth easing function
        const easing = (t) => {
            if (t < 0.5) {
                return 4 * t * t * t;
            } else {
                return 1 - Math.pow(-2 * t + 2, 3) / 2;
            }
        };

        const currentPosition = currentOffset + (spinDistance * easing(progress));
        container.style.transform = `translateX(-${currentPosition}px)`;

        if (progress < 1) {
            requestAnimationFrame(animate);
        } else {
            isSpinning = false;
            Array.from(fire).forEach(f => f.style.display = 'none');
            
            // Stop the audio
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }

            // Reset position and regenerate boxes
            currentOffset = currentPosition % singleSetWidth;
            container.style.transform = `translateX(-${currentOffset}px)`;
            
            // Regenerate boxes to ensure they're always present
            createBoxes();
        }
    }

    requestAnimationFrame(animate);
}

// Modified createBoxes function to ensure proper positioning
function createBoxes() {
    container.innerHTML = '';
    // Create 4 sets of items
    for (let i = 0; i < 6; i++) {
        potentialWinning.forEach(item => {
            const box = document.createElement('div');
            box.className = 'box';
            const img = document.createElement('img');
            img.className = 'image';
            img.src = item.image;
            img.alt = item.name;
            box.appendChild(img);
            container.appendChild(box);
        });
    }
    // Maintain current position after regenerating boxes
    container.style.transform = `translateX(-${currentOffset}px)`;
}





    </script>
</body>
</html>
